<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채용공고 상세정보</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="portfolio-banner">
        <nav class="menu">
            <a href="https://doyun2222.github.io/a2024/" target="_blank">Home</a>
            <a href="javascript:history.back()">Back</a>
        </nav>
    </header>
    <main>
        <section id="job-detail">
            <h1>채용공고 상세정보</h1>
            <div id="detail-container">
                <p>로딩 중...</p>
            </div>
        </section>
    </main>

    <script>
        // URL에서 쿼리 매개변수 파싱
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // API 호출
        function fetchJobDetail(sn) {
            const reqUrl = `https://apis.data.go.kr/1051000/recruitment/detail`;
            const serviceKey = "pKNkTBCcfio+4XDb3xpeAScbhWpzcdlcXlYBMywYpX+u0h9nUw1m3WekTcTneCAnG4KgnpW14Z7dXAjbT6tRmw==";

            const params = new URLSearchParams({
                serviceKey,
                resultType: "json",
                sn,
            });

            console.log("Fetching detail with SN:", sn); // 디버깅용 로그
            console.log("Request URL:", `${reqUrl}?${params.toString()}`); // 요청 URL 확인

            fetch(`${reqUrl}?${params.toString()}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then((data) => {
                    console.log("API Response:", data); // API 응답 데이터 확인
                    renderJobDetail(data);
                })
                .catch((error) => {
                    console.error("Error fetching job detail:", error); // 에러 로그
                    document.getElementById("detail-container").innerHTML = `<p>데이터를 불러오는 중 오류가 발생했습니다: ${error.message}</p>`;
                });
        }

        // 데이터 렌더링
        function renderJobDetail(data) {
            const container = document.getElementById("detail-container");
            if (data && data.response && data.response.body && data.response.body.items) {
                const detail = data.response.body.items[0]; // 첫 번째 항목 가져오기

                container.innerHTML = `
                    <h2>${detail.recrutPbancTtl || "제목 없음"}</h2>
                    <p><strong>기관명:</strong> ${detail.pblntInstNm || "정보 없음"}</p>
                    <p><strong>시작일:</strong> ${detail.pbancBgngYmd || "정보 없음"}</p>
                    <p><strong>종료일:</strong> ${detail.pbancEndYmd || "정보 없음"}</p>
                    <p><strong>채용분야:</strong> ${detail.ncsCdNmLst || "정보 없음"}</p>
                    <p><strong>고용형태:</strong> ${detail.hireTypeNmLst || "정보 없음"}</p>
                    <p><strong>채용인원:</strong> ${detail.recrutNope || "정보 없음"}</p>
                    <p><strong>상세정보:</strong> <a href="${detail.detailUrl || "#"}" target="_blank">공고 보기</a></p>
                `;
            } else {
                container.innerHTML = `<p>상세 정보를 가져올 수 없습니다. 응답 데이터 확인이 필요합니다.</p>`;
                console.warn("Unexpected response structure:", data); // 경고 메시지
            }
        }

        // 페이지 로드 시 실행
        document.addEventListener("DOMContentLoaded", () => {
            const sn = getQueryParam("sn");
            if (sn) {
                fetchJobDetail(sn);
            } else {
                document.getElementById("detail-container").innerHTML = `<p>잘못된 요청입니다. SN 번호가 없습니다.</p>`;
            }
        });
    </script>
</body>
</html>
